{
	"beadId": "bd-34y",
	"prdName": "glm5-modal-provider",
	"tasks": [
		{
			"id": "backend-1",
			"category": "backend",
			"description": "Create Modal provider package — internal/modal/ with ForwardRequest() that sends OpenAI-format requests to https://api.us-west-2.modal.direct/v1/chat/completions with Bearer auth from MODAL_API_KEY env var",
			"steps": [
				"go build ./internal/modal/... compiles successfully",
				"grep 'api.us-west-2.modal.direct' goproxy/internal/modal/modal.go returns match",
				"grep 'MODAL_API_KEY' goproxy/internal/modal/modal.go returns match"
			],
			"passes": false,
			"metadata": {
				"depends_on": [],
				"parallel": true,
				"conflicts_with": [],
				"files": ["goproxy/internal/modal/modal.go"]
			}
		},
		{
			"id": "backend-2",
			"category": "backend",
			"description": "Add Modal routing in main.go — selectUpstreamConfig() recognizes upstream: 'modal' and routes to Modal provider, chatCompletionsHandler() dispatches Modal requests through the new provider",
			"steps": [
				"grep -A5 '\"modal\"' goproxy/main.go shows Modal routing case",
				"go build -o /dev/null . compiles successfully in goproxy/"
			],
			"passes": false,
			"metadata": {
				"depends_on": ["backend-1"],
				"parallel": false,
				"conflicts_with": [],
				"files": ["goproxy/main.go"]
			}
		},
		{
			"id": "config-1",
			"category": "config",
			"description": "Update OpenHands config to use GLM-5 — replace all glm-4.6 references with glm-5 in config-openhands-prod.json",
			"steps": [
				"grep -c 'glm-4.6' goproxy/config-openhands-prod.json returns 0",
				"grep 'glm-5' goproxy/config-openhands-prod.json returns matches",
				"python3 -c \"import json; json.load(open('goproxy/config-openhands-prod.json'))\" succeeds (valid JSON)"
			],
			"passes": false,
			"metadata": {
				"depends_on": ["backend-2"],
				"parallel": false,
				"conflicts_with": [],
				"files": ["goproxy/config-openhands-prod.json"]
			}
		},
		{
			"id": "testing-1",
			"category": "testing",
			"description": "Integration verification — proxy compiles, all existing tests pass, go vet clean",
			"steps": [
				"go build -o /dev/null . in goproxy/ succeeds",
				"go test ./... in goproxy/ passes",
				"go vet ./... in goproxy/ passes"
			],
			"passes": false,
			"metadata": {
				"depends_on": ["config-1"],
				"parallel": false,
				"conflicts_with": [],
				"files": []
			}
		}
	],
	"context": {
		"patterns": [
			"Provider pattern: internal/<provider>/<provider>.go with ForwardRequest() + forwardToEndpoint()",
			"Config routing: main.go selectUpstreamConfig() switches on model.upstream field",
			"Random selection: config/config.go GetUpstreamModelID() handles string/array with weights"
		],
		"keyFiles": [
			"goproxy/config-openhands-prod.json",
			"goproxy/main.go",
			"goproxy/config/config.go",
			"goproxy/internal/openhands/openhands.go"
		],
		"nonGoals": [
			"Changing config-ohmygpt-prod.json",
			"Adding Modal as general-purpose provider",
			"Modifying billing logic",
			"Adding Anthropic/Messages format support",
			"UI changes"
		]
	},
	"beadMetadata": {
		"depends_on": [],
		"parallel": true,
		"conflicts_with": [],
		"blocks": [],
		"estimated_hours": 2
	}
}
