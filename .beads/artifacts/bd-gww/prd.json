{
	"beadId": "bd-gww",
	"prdName": "response-model-name-masking",
	"tasks": [
		{
			"id": "backend-1",
			"category": "backend",
			"title": "Add modelID parameter to maintarget OpenAI response handlers",
			"description": "The HandleOpenAIStreamResponse and HandleOpenAINonStreamResponse functions accept a modelID string parameter and use it to rewrite the model field in response bodies before forwarding to the client.",
			"steps": ["go build ./... succeeds", "go vet ./... passes"],
			"passes": true,
			"metadata": {
				"depends_on": [],
				"parallel": false,
				"conflicts_with": [],
				"files": ["goproxy/internal/maintarget/handler.go"]
			}
		},
		{
			"id": "backend-2",
			"category": "backend",
			"title": "Implement streaming SSE model name rewriting",
			"description": "Inside HandleOpenAIStreamResponse, each data: line except [DONE] is parsed as JSON, the model field is replaced with the provided modelID, re-serialized, and forwarded; lines that fail parsing are forwarded unchanged.",
			"steps": [
				"go build ./... succeeds",
				"go test ./internal/maintarget/... passes",
				"Manual test: streaming response shows user-facing model name"
			],
			"passes": true,
			"metadata": {
				"depends_on": [
					"Add modelID parameter to maintarget OpenAI response handlers"
				],
				"parallel": false,
				"conflicts_with": [],
				"files": ["goproxy/internal/maintarget/handler.go"]
			}
		},
		{
			"id": "backend-3",
			"category": "backend",
			"title": "Implement non-streaming JSON model name rewriting",
			"description": "Inside HandleOpenAINonStreamResponse, the response body is parsed as JSON, the model field is replaced with the provided modelID, re-serialized, and written; bodies that fail parsing are forwarded unchanged.",
			"steps": [
				"go build ./... succeeds",
				"go test ./internal/maintarget/... passes",
				"Manual test: non-streaming response shows user-facing model name"
			],
			"passes": true,
			"metadata": {
				"depends_on": [
					"Add modelID parameter to maintarget OpenAI response handlers"
				],
				"parallel": true,
				"conflicts_with": ["Implement streaming SSE model name rewriting"],
				"files": ["goproxy/internal/maintarget/handler.go"]
			}
		},
		{
			"id": "backend-4",
			"category": "backend",
			"title": "Update all call sites to pass modelID",
			"description": "All callers of HandleOpenAIStreamResponse and HandleOpenAINonStreamResponse in main.go, openhands.go, and ohmygpt.go pass the user-facing modelID to the updated handlers.",
			"steps": [
				"go build ./... succeeds (all call sites compile with new signature)",
				"go vet ./... passes",
				"go test ./... passes"
			],
			"passes": false,
			"metadata": {
				"depends_on": [
					"Add modelID parameter to maintarget OpenAI response handlers"
				],
				"parallel": false,
				"conflicts_with": [],
				"files": [
					"goproxy/main.go",
					"goproxy/internal/openhands/openhands.go",
					"goproxy/internal/ohmygpt/ohmygpt.go"
				]
			}
		},
		{
			"id": "test-1",
			"category": "test",
			"title": "End-to-end verification",
			"description": "Verify that streaming and non-streaming requests for models with upstream routing return the user-facing model name in the response body.",
			"steps": [
				"go build -o /dev/null ./... succeeds",
				"go test ./... passes",
				"Manual curl test with streaming shows correct model name in all chunks",
				"Manual curl test without streaming shows correct model name in response"
			],
			"passes": false,
			"metadata": {
				"depends_on": [
					"Implement streaming SSE model name rewriting",
					"Implement non-streaming JSON model name rewriting",
					"Update all call sites to pass modelID"
				],
				"parallel": false,
				"conflicts_with": [],
				"files": []
			}
		}
	],
	"context": {
		"patterns": [
			"Troll OpenAI stream path already rewrites model field via eventData[\"model\"] = modelID in goproxy/main.go",
			"Anthropic and Troll transformer paths already set model via transformer model constructor param",
			"Passthrough OpenAI responses from Modal/OpenHands/OhMyGPT flow through maintarget handlers"
		],
		"keyFiles": [
			"goproxy/internal/maintarget/handler.go",
			"goproxy/main.go",
			"goproxy/internal/openhands/openhands.go",
			"goproxy/internal/ohmygpt/ohmygpt.go"
		],
		"nonGoals": [
			"Rewrite model field in Anthropic-format responses",
			"Rewrite model field in Troll OpenAI responses",
			"Rewrite provider-specific headers",
			"Rewrite id field format or system_fingerprint",
			"Rewrite model names inside error messages"
		]
	},
	"beadMetadata": {
		"depends_on": [],
		"parallel": true,
		"conflicts_with": [],
		"blocks": [],
		"estimated_hours": 3
	}
}
