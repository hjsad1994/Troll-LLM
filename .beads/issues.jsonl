{"id":"trollLLM-14s","title":"Verify Go Proxy Error Logging","description":"Verify Go proxy error logging works correctly.\n\n**Acceptance Criteria**:\n- Trigger auth errors (invalid API key) and verify log\n- Trigger validation errors (invalid JSON) and verify log\n- Trigger upstream errors (bad gateway) and verify log\n- Trigger rate limit errors and verify log\n- Verify API keys are masked in logs\n- Verify async logging doesn't impact proxy performance\n\n**Test Steps**:\n1. Start goproxy server\n2. Make requests with invalid API keys\n3. Make requests with malformed JSON\n4. Query MongoDB: db.error_logs.find({source: 'goproxy'})\n5. Verify userKeyId is masked (sk-troll***xyz)\n6. Check latencyMs is captured","status":"open","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:34.306896+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:36:34.306896+07:00","dependencies":[{"issue_id":"trollLLM-14s","depends_on_id":"trollLLM-5td","type":"blocks","created_at":"2026-01-22T23:36:34.3089808+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-14s","depends_on_id":"trollLLM-846","type":"blocks","created_at":"2026-01-22T23:36:34.310529+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-14s","depends_on_id":"trollLLM-bb1","type":"blocks","created_at":"2026-01-22T23:36:34.3125915+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-14s","depends_on_id":"trollLLM-wja","type":"blocks","created_at":"2026-01-22T23:36:34.3141374+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-1jj","title":"Epic: Testing \u0026 Verification","status":"open","priority":2,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:26.4290205+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:34:26.4290205+07:00"}
{"id":"trollLLM-33e","title":"Epic: Go Proxy Error Logging (goproxy)","status":"open","priority":1,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:25.8522713+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:34:25.8522713+07:00"}
{"id":"trollLLM-4ep","title":"Build Authentication System","description":"Implement full auth system with login, register, JWT","status":"tombstone","priority":0,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:41:03.456979+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.5153047+07:00","deleted_at":"2026-01-21T03:46:53.5153047+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-5cd","title":"Create errorlog Helper Functions (helper.go)","description":"Create helper functions for http.Error replacement.\n\n**File**: goproxy/internal/errorlog/helper.go\n\n**Acceptance Criteria**:\n- HTTPError() - drop-in replacement for http.Error with logging\n- HTTPErrorWithContext() - enhanced version with user context\n- Both functions write error response AND log to MongoDB\n- Extract error message from JSON body if possible\n\n**Technical Notes**:\n- HTTPError writes response first, then logs async\n- Parse JSON body to extract error.message field\n- Support variadic LogErrorParams for optional context","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:24.8658433+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:35:24.8658433+07:00","dependencies":[{"issue_id":"trollLLM-5cd","depends_on_id":"trollLLM-x9b","type":"blocks","created_at":"2026-01-22T23:35:24.8678904+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-5td","title":"Update main.go - Authentication Errors (~15 locations)","description":"Replace http.Error with errorlog.HTTPError for authentication error paths.\n\n**File**: goproxy/main.go\n\n**Scope**: Lines ~584-664 and other auth-related error locations\n\n**Acceptance Criteria**:\n- All authentication errors (401) use errorlog.HTTPError\n- Invalid API key errors are logged\n- Friend Key deactivation errors are logged\n- Owner account inactive errors are logged\n- Approximately 15 locations updated\n\n**Technical Notes**:\n- Search for: http.StatusUnauthorized\n- Include user context where available (userID, userKeyID)\n- Pattern: errorlog.HTTPError(w, r, body, statusCode)","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:35.4369348+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:35:35.4369348+07:00","dependencies":[{"issue_id":"trollLLM-5td","depends_on_id":"trollLLM-5cd","type":"blocks","created_at":"2026-01-22T23:35:35.438512+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-70z","title":"Implement register API endpoint","description":"POST /api/auth/register with validation","status":"tombstone","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:41:13.4594674+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.3629247+07:00","deleted_at":"2026-01-21T03:46:53.3629247+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-7vf","title":"Implement login API endpoint","description":"POST /api/auth/login with JWT response","status":"tombstone","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:41:13.2418225+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.2123297+07:00","deleted_at":"2026-01-21T03:46:53.2123297+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-846","title":"Update main.go - Validation Errors (~10 locations)","description":"Replace http.Error with errorlog.HTTPError for validation error paths.\n\n**File**: goproxy/main.go\n\n**Scope**: Lines ~719, 748 and other validation error locations\n\n**Acceptance Criteria**:\n- All validation errors (400) use errorlog.HTTPError\n- Invalid JSON errors are logged\n- Failed to read request body errors are logged\n- Invalid model errors are logged (404)\n- Approximately 10 locations updated\n\n**Technical Notes**:\n- Search for: http.StatusBadRequest, http.StatusNotFound\n- Include request body context where safe\n- Pattern: errorlog.HTTPError(w, r, body, statusCode)","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:43.9211704+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:35:43.9211704+07:00","dependencies":[{"issue_id":"trollLLM-846","depends_on_id":"trollLLM-5cd","type":"blocks","created_at":"2026-01-22T23:35:43.9227026+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-97u","title":"Security Audit - No Sensitive Data in Logs","description":"Audit error logs to ensure no sensitive data is leaked.\n\n**Acceptance Criteria**:\n- No passwords in requestBody\n- No API tokens in requestBody or requestHeaders\n- No authorization headers logged\n- API keys are properly masked (show only first 7 + last 3 chars)\n- No secret keys or credentials in any field\n\n**Audit Steps**:\n1. Query recent error logs\n2. Inspect requestBody for any password/token fields\n3. Inspect requestHeaders - should only have safe headers\n4. Verify userKeyId masking format\n5. Document any issues found","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:53.5776492+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:36:53.5776492+07:00","dependencies":[{"issue_id":"trollLLM-97u","depends_on_id":"trollLLM-ekb","type":"blocks","created_at":"2026-01-22T23:36:53.5792356+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-97u","depends_on_id":"trollLLM-14s","type":"blocks","created_at":"2026-01-22T23:36:53.5807747+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-a8w","title":"Setup TrolLLM proxy server","status":"tombstone","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:40:20.4184883+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.6552505+07:00","deleted_at":"2026-01-21T03:46:53.6552505+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-bb1","title":"Update main.go - Upstream Errors (~20 locations)","description":"Replace http.Error with errorlog.HTTPError for upstream error paths.\n\n**File**: goproxy/main.go\n\n**Scope**: Lines ~987, 1041, 1138 and other upstream error locations\n\n**Acceptance Criteria**:\n- All upstream errors (502, 503) use errorlog.HTTPError\n- Request to upstream failed errors are logged\n- Main target not configured errors are logged\n- Service unavailable errors are logged\n- Approximately 20 locations updated\n\n**Technical Notes**:\n- Search for: http.StatusBadGateway, http.StatusServiceUnavailable, http.StatusInternalServerError\n- Include latency context where available\n- These are critical for debugging upstream issues","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:52.1345597+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:35:52.1345597+07:00","dependencies":[{"issue_id":"trollLLM-bb1","depends_on_id":"trollLLM-5cd","type":"blocks","created_at":"2026-01-22T23:35:52.136124+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-cys","title":"Epic: Backend Error Logging (Node.js/Express)","description":"Implement error logging middleware for Node.js/Express backend to capture all 4xx/5xx errors and persist to MongoDB.\n\n**Goal**: Enable developers to debug and trace backend errors easily.\n\n**Scope**:\n- ErrorLog Mongoose model with TTL index (30 days)\n- Express middleware to intercept error responses\n- Async logging (non-blocking)\n- Sensitive data sanitization\n\n**Acceptance Criteria**:\n- All 4xx/5xx responses are logged to error_logs collection\n- No sensitive data (passwords, tokens) in logs\n- Logging doesn't impact response time\n- TTL auto-deletes logs after 30 days\n\n**Reference**: .sisyphus/plans/error-logging-mongodb.md","status":"open","priority":1,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:18.879512+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:00:04.2975742+07:00"}
{"id":"trollLLM-dqk","title":"Verify TTL Index and Data Retention","description":"Verify MongoDB TTL index is working correctly.\n\n**Acceptance Criteria**:\n- TTL index exists on createdAt field\n- Index is set to expire after 2592000 seconds (30 days)\n- Manual verification that documents will be auto-deleted\n\n**Test Steps**:\n1. Connect to MongoDB\n2. Run: db.error_logs.getIndexes()\n3. Verify TTL index configuration\n4. (Optional) Create test document with old createdAt and verify deletion","status":"open","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:43.7775451+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:36:43.7775451+07:00","dependencies":[{"issue_id":"trollLLM-dqk","depends_on_id":"trollLLM-ekb","type":"blocks","created_at":"2026-01-22T23:36:43.7791053+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-dqk","depends_on_id":"trollLLM-14s","type":"blocks","created_at":"2026-01-22T23:36:43.7812813+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-ekb","title":"Test Backend Error Logging","description":"Verify backend error logging works correctly.\n\n**Acceptance Criteria**:\n- Trigger 400 error (e.g., invalid request body) and verify log in MongoDB\n- Trigger 401 error (invalid/missing auth) and verify log\n- Trigger 500 error (force server error) and verify log with stack trace\n- Verify sensitive data is sanitized (no passwords, tokens in logs)\n- Verify async logging doesn't block response time\n\n**Test Steps**:\n1. Start backend server\n2. Make requests that trigger various errors\n3. Query MongoDB: db.error_logs.find({source: 'backend'})\n4. Verify all fields are populated correctly\n5. Check no sensitive data in requestBody/requestHeaders","status":"open","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:11.8525074+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:36:11.8525074+07:00","dependencies":[{"issue_id":"trollLLM-ekb","depends_on_id":"trollLLM-ltc","type":"blocks","created_at":"2026-01-22T23:36:11.8545817+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-ekb","depends_on_id":"trollLLM-jcm","type":"blocks","created_at":"2026-01-22T23:36:11.8571659+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-frq","title":"Create ErrorLog Mongoose Model","description":"Create error-log.model.ts with IErrorLog interface and Mongoose schema.\n\n**File**: backend/src/models/error-log.model.ts\n\n**Acceptance Criteria**:\n- Schema includes all fields: source, method, path, endpoint, userId, userKeyId, clientIp, userAgent, statusCode, errorType, errorMessage, errorDetails, requestHeaders, requestBody, responseBody, latencyMs, stackTrace, createdAt\n- TTL index set to 30 days (expires: 2592000)\n- Compound indexes for common queries (source+createdAt, path+createdAt)\n- Export IErrorLog interface and ErrorLog model\n\n**Technical Notes**:\n- Use mongoose.Schema.Types.Mixed for flexible fields (errorDetails, requestBody, etc.)\n- Collection name: 'error_logs'","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:37.5794434+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:34:37.5794434+07:00","dependencies":[{"issue_id":"trollLLM-frq","depends_on_id":"trollLLM-cys","type":"blocks","created_at":"2026-01-22T23:34:37.5809918+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-gwa","title":"Setup database schema for users","description":"Create User model with email, password hash, timestamps","status":"tombstone","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:41:13.033652+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.058109+07:00","deleted_at":"2026-01-21T03:46:53.058109+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-jcm","title":"Export ErrorLog Model from models/index.ts","description":"Add ErrorLog model export to models barrel file.\n\n**File**: backend/src/models/index.ts\n\n**Acceptance Criteria**:\n- Add export * from './error-log.model.js'\n- Model is accessible via import from models/index\n\n**Technical Notes**:\n- Simple one-line addition to existing exports","status":"open","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:04.5973334+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:35:04.5973334+07:00","dependencies":[{"issue_id":"trollLLM-jcm","depends_on_id":"trollLLM-frq","type":"blocks","created_at":"2026-01-22T23:35:04.5988935+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-ltc","title":"Register Error Logger Middleware in Express App","description":"Register errorLoggerMiddleware in Express application.\n\n**File**: backend/src/index.ts\n\n**Acceptance Criteria**:\n- Import errorLoggerMiddleware from middleware\n- Register AFTER express.json() but BEFORE all routes\n- Middleware is applied globally to all routes\n\n**Technical Notes**:\n- Order matters: app.use(express.json()) then app.use(errorLoggerMiddleware)\n- Must be before route definitions to capture all errors","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:55.7250554+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:34:55.7250554+07:00","dependencies":[{"issue_id":"trollLLM-ltc","depends_on_id":"trollLLM-o39","type":"blocks","created_at":"2026-01-22T23:34:55.7265935+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-o39","title":"Create Error Logger Middleware","description":"Create Express middleware to intercept and log 4xx/5xx errors to MongoDB.\n\n**File**: backend/src/middleware/error-logger.middleware.ts\n\n**Acceptance Criteria**:\n- Intercepts res.json() to capture error responses\n- Only logs statusCode \u003e= 400\n- Logs asynchronously (setImmediate) to not block response\n- Sanitizes sensitive data (passwords, tokens, apiKey, secret)\n- Captures safe headers only (content-type, accept, origin, referer, x-request-id)\n- Classifies error types based on status code\n- Captures stack trace for 5xx errors\n\n**Technical Notes**:\n- Override res.json.bind(res) pattern\n- Use setImmediate for async logging\n- sanitizeBody() function for request body\n- getSafeHeaders() for header filtering\n- classifyError() for error type mapping","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:47.1349271+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:34:47.1349271+07:00","dependencies":[{"issue_id":"trollLLM-o39","depends_on_id":"trollLLM-frq","type":"blocks","created_at":"2026-01-22T23:34:47.1365359+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-wja","title":"Update main.go - Rate Limit \u0026 Payment Errors (~10 locations)","description":"Replace http.Error with errorlog.HTTPError for rate limit and payment error paths.\n\n**File**: goproxy/main.go\n\n**Scope**: Lines ~466, 629, 652, 657 and related locations\n\n**Acceptance Criteria**:\n- Rate limit errors (429) use errorlog.HTTPError\n- Payment required errors (402) use errorlog.HTTPError  \n- Insufficient credits errors are logged\n- Approximately 10 locations updated\n\n**Technical Notes**:\n- Search for: http.StatusTooManyRequests, http.StatusPaymentRequired, http.StatusForbidden\n- Include user context for billing/rate limit analysis\n- Important for understanding usage patterns","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:00.9313886+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:36:00.9313886+07:00","dependencies":[{"issue_id":"trollLLM-wja","depends_on_id":"trollLLM-5cd","type":"blocks","created_at":"2026-01-22T23:36:00.9329292+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-x9b","title":"Create errorlog Package Core (errorlog.go)","description":"Create the core errorlog package with ErrorLog struct and LogError function.\n\n**File**: goproxy/internal/errorlog/errorlog.go\n\n**Acceptance Criteria**:\n- ErrorLog struct with all fields matching backend schema\n- getCollection() with lazy initialization and index creation\n- ClassifyError() function for status code to error type mapping\n- GetClientIP() to extract client IP (X-Forwarded-For, X-Real-IP, RemoteAddr)\n- GetSafeHeaders() to filter sensitive headers\n- MaskAPIKey() to mask API keys for logging\n- LogError() that logs asynchronously via goroutine\n- LogErrorSimple() helper for basic logging\n\n**Technical Notes**:\n- Use go.mongodb.org/mongo-driver for MongoDB operations\n- Index creation is idempotent (runs on first getCollection call)\n- TTL index: 2592000 seconds (30 days)\n- Always log asynchronously with go func()","status":"open","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:15.8097967+07:00","created_by":"hjsad1994","updated_at":"2026-01-22T23:35:15.8097967+07:00","dependencies":[{"issue_id":"trollLLM-x9b","depends_on_id":"trollLLM-33e","type":"blocks","created_at":"2026-01-22T23:35:15.8113312+07:00","created_by":"hjsad1994"}]}
