{"id":"trollLLM-0hk","title":"Add findByUserIdPaginated() to payment repository","description":"File: backend/src/repositories/payment.repository.ts\n\nAdd paginated query method with filters:\n- page: Page number (default 1)\n- limit: Items per page (default 20)\n- status: Filter by payment status (optional)\n- from/to: Date range filter (optional)\n\nReturns: { payments, total, page, totalPages }\n\nAcceptance Criteria:\n- Pagination works correctly\n- Filters can be combined\n- Results sorted by createdAt descending\n- Empty results return empty array with correct metadata","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:11:58.5690637+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.2304389+07:00","closed_at":"2026-01-24T22:39:15.2304389+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-0hk","depends_on_id":"trollLLM-dh2","type":"blocks","created_at":"2026-01-24T22:11:58.5706118+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-14s","title":"Verify Go Proxy Error Logging","description":"Verify Go proxy error logging works correctly.\n\n**Acceptance Criteria**:\n- Trigger auth errors (invalid API key) and verify log\n- Trigger validation errors (invalid JSON) and verify log\n- Trigger upstream errors (bad gateway) and verify log\n- Trigger rate limit errors and verify log\n- Verify API keys are masked in logs\n- Verify async logging doesn't impact proxy performance\n\n**Test Steps**:\n1. Start goproxy server\n2. Make requests with invalid API keys\n3. Make requests with malformed JSON\n4. Query MongoDB: db.error_logs.find({source: 'goproxy'})\n5. Verify userKeyId is masked (sk-troll***xyz)\n6. Check latencyMs is captured","status":"closed","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:34.306896+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:47:58.1057331+07:00","closed_at":"2026-01-23T00:47:58.1057331+07:00","close_reason":"Verified: Goproxy logs 401 (Invalid API key) for /v1/chat/completions and /v1/messages. API keys masked as ***. Headers sanitized.","dependencies":[{"issue_id":"trollLLM-14s","depends_on_id":"trollLLM-5td","type":"blocks","created_at":"2026-01-22T23:36:34.3089808+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-14s","depends_on_id":"trollLLM-846","type":"blocks","created_at":"2026-01-22T23:36:34.310529+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-14s","depends_on_id":"trollLLM-bb1","type":"blocks","created_at":"2026-01-22T23:36:34.3125915+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-14s","depends_on_id":"trollLLM-wja","type":"blocks","created_at":"2026-01-22T23:36:34.3141374+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-14s","depends_on_id":"trollLLM-1jj","type":"blocks","created_at":"2026-01-23T00:05:55.154294+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-1ca","title":"Add frontend API types and functions","description":"File: frontend/src/lib/api.ts\n\nAdd TypeScript types:\n- PaymentStats interface\n- PaymentHistoryPaginatedResponse interface\n\nAdd API functions:\n- getUserPaymentStats(): Promise\u003cPaymentStats\u003e\n- getPaymentHistoryPaginated(params): Promise\u003cPaymentHistoryPaginatedResponse\u003e\n\nBoth use fetchWithAuth for authenticated requests.\n\nAcceptance Criteria:\n- Types match backend response format\n- Functions handle errors properly\n- Query params built correctly for paginated endpoint","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:12:18.6501542+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.3861222+07:00","closed_at":"2026-01-24T22:39:15.3861222+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-1ca","depends_on_id":"trollLLM-9q4","type":"blocks","created_at":"2026-01-24T22:12:18.6522277+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-1ca","depends_on_id":"trollLLM-5gd","type":"blocks","created_at":"2026-01-24T22:12:18.6553177+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-1jj","title":"Epic: Testing \u0026 Verification","description":"Verify both backend and Go proxy error logging implementations work correctly.\\n\\n**Goal**: Ensure error logging is fully functional before deploying.\\n\\n**Scope**:\\n- Backend error logging verification (4xx/5xx responses)\\n- Go proxy error logging verification (auth, validation, upstream, rate limit errors)\\n- Security audit (no sensitive data leaked)\\n- TTL index verification (30-day auto-deletion)\\n\\n**Acceptance Criteria**:\\n- Both backend and goproxy log errors to MongoDB\\n- Sensitive data is properly sanitized/masked\\n- TTL index is correctly configured\\n- No performance degradation from logging","status":"closed","priority":2,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:26.4290205+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:48:08.5424172+07:00","closed_at":"2026-01-23T00:48:08.5424172+07:00","close_reason":"Testing \u0026 Verification complete: Backend and Goproxy error logging verified. Security audit passed (passwords redacted, API keys masked, auth headers excluded). TTL index confirmed at 30 days."}
{"id":"trollLLM-1ti","title":"Epic: OpenHands Proactive Spend-Based Key Rotation","status":"closed","priority":0,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:23:15.0862491+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T05:01:00.9028796+07:00","closed_at":"2026-01-23T05:01:00.9028796+07:00","close_reason":"Closed"}
{"id":"trollLLM-26l","title":"Create SpendChecker service [CORE]","description":"Create spend_checker.go with: SpendChecker struct, Start/Stop methods, checkAllKeys loop, isKeyActive, shouldCheckKey, checkKeySpend (API call), updateKeySpendInfo, saveSpendHistory, GetStats. Threshold $9.8, active interval 10s, idle interval 1h.","status":"closed","priority":0,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:23:46.2374486+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T04:56:47.6403137+07:00","closed_at":"2026-01-23T04:56:47.6403137+07:00","close_reason":"Closed","dependencies":[{"issue_id":"trollLLM-26l","depends_on_id":"trollLLM-9le","type":"blocks","created_at":"2026-01-23T04:23:46.2389898+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-26l","depends_on_id":"trollLLM-3z2","type":"blocks","created_at":"2026-01-23T04:23:46.2410397+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-33e","title":"Epic: Go Proxy Error Logging (goproxy)","description":"Implement error logging in Go proxy to capture all HTTP errors and persist to MongoDB.\\n\\n**Goal**: Enable developers to debug and trace proxy errors easily.\\n\\n**Scope**:\\n- errorlog package with ErrorLog struct and MongoDB operations\\n- Helper functions for http.Error replacement\\n- Replace ~55 http.Error calls with errorlog.HTTPError\\n- Async logging (non-blocking)\\n- Sensitive data masking (API keys)\\n\\n**Acceptance Criteria**:\\n- All 4xx/5xx responses are logged to error_logs collection\\n- API keys are masked in logs (sk-troll***xyz format)\\n- Logging doesn't impact proxy performance\\n- TTL auto-deletes logs after 30 days\\n- Same schema as backend error logs\\n\\n**Reference**: .sisyphus/plans/error-logging-mongodb.md","status":"closed","priority":1,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:25.8522713+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:31:24.2558636+07:00","closed_at":"2026-01-23T00:31:24.2558636+07:00","close_reason":"Go Proxy Error Logging complete: errorlog package with ErrorLog struct, async logging, helper functions. Updated main.go auth/validation/payment errors. Build passes."}
{"id":"trollLLM-3z2","title":"Add getClientWithProxyOnly method to OpenHandsProvider","description":"Add new method getClientWithProxyOnly() to openhands.go that returns HTTP client with proxy WITHOUT selecting a new key. Needed for SpendChecker to check specific key spend.","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:23:38.0932095+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T04:55:11.7875089+07:00","closed_at":"2026-01-23T04:55:11.7875089+07:00","close_reason":"Closed","dependencies":[{"issue_id":"trollLLM-3z2","depends_on_id":"trollLLM-4j9","type":"blocks","created_at":"2026-01-23T04:23:38.0948483+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-4ep","title":"Build Authentication System","description":"Implement full auth system with login, register, JWT","status":"tombstone","priority":0,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:41:03.456979+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.5153047+07:00","deleted_at":"2026-01-21T03:46:53.5153047+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-4j9","title":"Extend OpenHandsKey struct with spend tracking fields","description":"Add 3 new fields to OpenHandsKey struct: LastUsedAt (*time.Time), TotalSpend (float64), LastSpendCheck (*time.Time). Update in: openhands.go, openhands.service.ts, backup.go","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:23:30.7428249+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T04:52:42.674706+07:00","closed_at":"2026-01-23T04:52:42.674706+07:00","close_reason":"Closed"}
{"id":"trollLLM-5cd","title":"Create errorlog Helper Functions (helper.go)","description":"Create helper functions for http.Error replacement.\n\n**File**: goproxy/internal/errorlog/helper.go\n\n**Acceptance Criteria**:\n- HTTPError() - drop-in replacement for http.Error with logging\n- HTTPErrorWithContext() - enhanced version with user context\n- Both functions write error response AND log to MongoDB\n- Extract error message from JSON body if possible\n\n**Technical Notes**:\n- HTTPError writes response first, then logs async\n- Parse JSON body to extract error.message field\n- Support variadic LogErrorParams for optional context","acceptance_criteria":"- [ ] HTTPError(w, r, body []byte, statusCode int) exported\\n- [ ] HTTPErrorWithContext(w, r, body []byte, statusCode int, params ...LogErrorParams) exported\\n- [ ] Both write HTTP response first, then log async\\n- [ ] Extract error.message from JSON body if parseable\\n- [ ] LogErrorParams struct for optional context (UserID, UserKeyID, Latency)\\n- [ ] Signature matches http.Error for easy replacement\\n- [ ] go build passes","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:24.8658433+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:29:58.6667863+07:00","closed_at":"2026-01-23T00:29:58.6667863+07:00","close_reason":"Created helper.go with HTTPError, HTTPErrorWithUser, HTTPErrorWithContext, JSONError, JSONErrorWithUser functions. All log asynchronously via LogError.","dependencies":[{"issue_id":"trollLLM-5cd","depends_on_id":"trollLLM-x9b","type":"blocks","created_at":"2026-01-22T23:35:24.8678904+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-5gd","title":"Add API routes for payment stats and history","description":"File: backend/src/routes/payment.routes.ts\n\nAdd 2 new endpoints:\n\n1. GET /api/payment/user-stats\n   - Auth: jwtAuth required\n   - Returns: PaymentStats object\n\n2. GET /api/payment/history-paginated\n   - Auth: jwtAuth required\n   - Query params: page, limit, status, from, to\n   - Returns: { payments, total, page, totalPages }\n\nAcceptance Criteria:\n- Both endpoints require authentication\n- Unauthorized returns 401\n- Errors return 500 with message\n- Query params parsed correctly","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:12:09.2554338+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.3364227+07:00","closed_at":"2026-01-24T22:39:15.3364227+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-5gd","depends_on_id":"trollLLM-rb0","type":"blocks","created_at":"2026-01-24T22:12:09.2580412+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-5gd","depends_on_id":"trollLLM-0hk","type":"blocks","created_at":"2026-01-24T22:12:09.2606698+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-5p5","title":"Add payments navigation to Sidebar","description":"File: frontend/src/components/Sidebar.tsx\n\nAdd nav item to userNavItems array:\n- href: '/payments'\n- labelKey: 'payments'\n- icon: Credit card/money SVG icon\n\nPosition: After dashboard item, before models item\n\nAcceptance Criteria:\n- Nav item appears for regular users\n- Nav item appears for admin users\n- Active state highlights correctly when on /payments\n- Icon matches design system","status":"closed","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:12:21.7720966+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.6124455+07:00","closed_at":"2026-01-24T22:39:15.6124455+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-5p5","depends_on_id":"trollLLM-9q4","type":"blocks","created_at":"2026-01-24T22:12:21.7736295+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-5td","title":"Update main.go - Authentication Errors (~15 locations)","description":"Replace http.Error with errorlog.HTTPError for authentication error paths.\\n\\n**File**: goproxy/main.go\\n\\n**Scope**: Lines ~584-664 and other auth-related error locations\\n\\n**PARALLELIZATION NOTE**: This task can run IN PARALLEL with trollLLM-846, trollLLM-bb1, trollLLM-wja since they modify different error paths.\\n\\n**Search Patterns**:\\n- http.StatusUnauthorized\\n- \"Invalid API key\"\\n- \"Friend Key\" errors\\n- \"Owner account inactive\"\\n\\n**Technical Notes**:\\n- Include user context where available (userID, userKeyID)\\n- Pattern: errorlog.HTTPError(w, r, body, statusCode)\\n- Approximately 15 locations","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:35.4369348+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:30:12.9353735+07:00","closed_at":"2026-01-23T00:30:12.9353735+07:00","close_reason":"Updated chatCompletionsHandler and handleAnthropicMessagesEndpoint with errorlog calls for all auth errors (Invalid API key, Friend Key errors, revoked, insufficient credits, etc.)","dependencies":[{"issue_id":"trollLLM-5td","depends_on_id":"trollLLM-5cd","type":"blocks","created_at":"2026-01-22T23:35:35.438512+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-6ed","title":"Integration testing - Payment History feature","description":"End-to-end testing of Payment History feature:\n\nBackend Tests:\n- [ ] /api/payment/user-stats returns correct stats\n- [ ] /api/payment/history-paginated returns paginated results\n- [ ] Filters work (status, date range)\n- [ ] Pagination works correctly\n- [ ] Unauthorized returns 401\n\nFrontend Tests:\n- [ ] Stats cards display correct data\n- [ ] Table renders payment list\n- [ ] Status filter works\n- [ ] Date range filter works\n- [ ] Pagination navigation works\n- [ ] Empty state shows when no payments\n- [ ] Loading states display correctly\n- [ ] Mobile responsive works\n- [ ] i18n translations work (EN/VI)\n\nAcceptance Criteria:\n- All test cases pass\n- No console errors\n- Feature works end-to-end","status":"closed","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:12:58.4475483+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.7324469+07:00","closed_at":"2026-01-24T22:39:15.7324469+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-6ed","depends_on_id":"trollLLM-9ez","type":"blocks","created_at":"2026-01-24T22:12:58.449092+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-6ed","depends_on_id":"trollLLM-z89","type":"blocks","created_at":"2026-01-24T22:12:58.4516684+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-6ed","depends_on_id":"trollLLM-cf1","type":"blocks","created_at":"2026-01-24T22:12:58.453722+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-6ed","depends_on_id":"trollLLM-mke","type":"blocks","created_at":"2026-01-24T22:12:58.4553435+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-6vg","title":"Add Backend API endpoints for spend monitoring","description":"Add to openhands.routes.ts: GET /admin/openhands/spend-summary (overview all keys), GET /admin/openhands/spend-history (history with optional keyId filter). Import mongoose.","status":"closed","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:24:09.1626591+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T05:00:25.0517888+07:00","closed_at":"2026-01-23T05:00:25.0517888+07:00","close_reason":"Closed","dependencies":[{"issue_id":"trollLLM-6vg","depends_on_id":"trollLLM-4j9","type":"blocks","created_at":"2026-01-23T04:24:09.1648801+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-70z","title":"Implement register API endpoint","description":"POST /api/auth/register with validation","status":"tombstone","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:41:13.4594674+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.3629247+07:00","deleted_at":"2026-01-21T03:46:53.3629247+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-7vf","title":"Implement login API endpoint","description":"POST /api/auth/login with JWT response","status":"tombstone","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:41:13.2418225+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.2123297+07:00","deleted_at":"2026-01-21T03:46:53.2123297+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-846","title":"Update main.go - Validation Errors (~10 locations)","description":"Replace http.Error with errorlog.HTTPError for validation error paths.\\n\\n**File**: goproxy/main.go\\n\\n**Scope**: Lines ~719, 748 and other validation error locations\\n\\n**PARALLELIZATION NOTE**: This task can run IN PARALLEL with trollLLM-5td, trollLLM-bb1, trollLLM-wja since they modify different error paths.\\n\\n**Search Patterns**:\\n- http.StatusBadRequest\\n- http.StatusNotFound\\n- \"Invalid JSON\"\\n- \"Failed to read request body\"\\n- \"Invalid model\"\\n\\n**Technical Notes**:\\n- Include request body context where safe\\n- Pattern: errorlog.HTTPError(w, r, body, statusCode)\\n- Approximately 10 locations","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:43.9211704+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:30:13.9959248+07:00","closed_at":"2026-01-23T00:30:13.9959248+07:00","close_reason":"Updated validation errors (Invalid JSON, Failed to read body, Model not found, Friend Key model limits) with errorlog calls","dependencies":[{"issue_id":"trollLLM-846","depends_on_id":"trollLLM-5cd","type":"blocks","created_at":"2026-01-22T23:35:43.9227026+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-94p","title":"Epic: User Payment History Dashboard","status":"closed","priority":1,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:11:36.629447+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:38:34.0521398+07:00","closed_at":"2026-01-24T22:38:34.0521398+07:00","close_reason":"Epic Complete - All phases implemented: Backend API (repository, service, routes), Frontend UI (api.ts, payments/page.tsx, Sidebar.tsx), i18n translations (EN/VI). Both builds pass. Route: /payments"}
{"id":"trollLLM-97u","title":"Security Audit - No Sensitive Data in Logs","description":"Audit error logs to ensure no sensitive data is leaked.\n\n**Acceptance Criteria**:\n- No passwords in requestBody\n- No API tokens in requestBody or requestHeaders\n- No authorization headers logged\n- API keys are properly masked (show only first 7 + last 3 chars)\n- No secret keys or credentials in any field\n\n**Audit Steps**:\n1. Query recent error logs\n2. Inspect requestBody for any password/token fields\n3. Inspect requestHeaders - should only have safe headers\n4. Verify userKeyId masking format\n5. Document any issues found","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:53.5776492+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:47:59.6967649+07:00","closed_at":"2026-01-23T00:47:59.6967649+07:00","close_reason":"Security verified: passwords [REDACTED], API keys masked ***, auth headers excluded, only safe headers logged (content-type, accept, user-agent, origin, referer, x-request-id)","dependencies":[{"issue_id":"trollLLM-97u","depends_on_id":"trollLLM-ekb","type":"blocks","created_at":"2026-01-22T23:36:53.5792356+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-97u","depends_on_id":"trollLLM-14s","type":"blocks","created_at":"2026-01-22T23:36:53.5807747+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-97u","depends_on_id":"trollLLM-1jj","type":"blocks","created_at":"2026-01-23T00:06:01.1386228+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-9ez","title":"Create Payment History page - Stats Cards","description":"File: frontend/src/app/(dashboard)/payments/page.tsx\n\nCreate stats cards section:\n- 4 cards in responsive grid (1 col mobile, 2 col tablet, 4 col desktop)\n- Cards: Total Credits, Total VND, Success Orders, Pending Orders\n- Each card has icon, label, value with proper formatting\n- Match existing dashboard card styling (borders, colors, hover)\n\nUse getUserPaymentStats() API function.\n\nAcceptance Criteria:\n- Stats load and display correctly\n- Loading skeleton while fetching\n- Numbers formatted properly (VND with separators, USD with $)\n- Responsive layout works","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:12:31.5924862+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.4372498+07:00","closed_at":"2026-01-24T22:39:15.4372498+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-9ez","depends_on_id":"trollLLM-1ca","type":"blocks","created_at":"2026-01-24T22:12:31.5948299+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-9le","title":"Fix lastUsedAt bug in main.go [CRITICAL]","description":"Two locations in goproxy/main.go update OpenHands key stats but do NOT update lastUsedAt. Lines ~1569 and ~1994. Add $set with lastUsedAt: time.Now() to both UpdateByID calls.","status":"closed","priority":0,"issue_type":"bug","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:23:23.090666+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T04:41:39.3741444+07:00","closed_at":"2026-01-23T04:41:39.3741444+07:00","close_reason":"Closed"}
{"id":"trollLLM-9q4","title":"Epic: Frontend UI - Payment History Page","description":"Phase 2: Xây dựng giao diện frontend cho trang Payment History, bao gồm stats cards, filters, table với pagination, và responsive design.","status":"closed","priority":1,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:11:44.7897409+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.0686139+07:00","closed_at":"2026-01-24T22:39:15.0686139+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented"}
{"id":"trollLLM-a8w","title":"Setup TrolLLM proxy server","status":"tombstone","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:40:20.4184883+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.6552505+07:00","deleted_at":"2026-01-21T03:46:53.6552505+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-abm","title":"Verify end-to-end spend checker functionality","description":"Verification checklist: 1) lastUsedAt updated after request, 2) Log startup message, 3) Log spend check with percentage, 4) Proactive rotation at threshold, 5) curl spend-stats returns JSON, 6) go test passes","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:24:16.6823549+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T05:01:00.653506+07:00","closed_at":"2026-01-23T05:01:00.653506+07:00","close_reason":"Closed","dependencies":[{"issue_id":"trollLLM-abm","depends_on_id":"trollLLM-n81","type":"blocks","created_at":"2026-01-23T04:24:16.6839028+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-abm","depends_on_id":"trollLLM-6vg","type":"blocks","created_at":"2026-01-23T04:24:16.6855096+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-bb1","title":"Update main.go - Upstream Errors (~20 locations)","description":"Replace http.Error with errorlog.HTTPError for upstream error paths.\\n\\n**File**: goproxy/main.go\\n\\n**Scope**: Lines ~987, 1041, 1138 and other upstream error locations\\n\\n**PARALLELIZATION NOTE**: This task can run IN PARALLEL with trollLLM-5td, trollLLM-846, trollLLM-wja since they modify different error paths.\\n\\n**Search Patterns**:\\n- http.StatusBadGateway\\n- http.StatusServiceUnavailable\\n- http.StatusInternalServerError\\n- \"Request to upstream failed\"\\n- \"Main target not configured\"\\n- \"Service unavailable\"\\n\\n**Technical Notes**:\\n- Include latency context where available\\n- These are critical for debugging upstream issues\\n- Pattern: errorlog.HTTPError(w, r, body, statusCode)\\n- Approximately 20 locations","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:52.1345597+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:30:15.2310443+07:00","closed_at":"2026-01-23T00:30:15.2310443+07:00","close_reason":"Updated key upstream errors at entry points. Internal helper functions retain http.Error since they lack request context.","dependencies":[{"issue_id":"trollLLM-bb1","depends_on_id":"trollLLM-5cd","type":"blocks","created_at":"2026-01-22T23:35:52.136124+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-c0j","title":"Add payment service methods","description":"File: backend/src/services/payment.service.ts\n\nAdd service layer methods:\n1. getUserPaymentStats(userId) - Calls repository method\n2. getPaymentHistoryPaginated(userId, options) - Parses options and calls repository\n\nService handles:\n- Type conversion (string to int for page/limit)\n- Date parsing for from/to filters\n- Status validation\n\nAcceptance Criteria:\n- Service methods properly delegate to repository\n- Input validation/parsing works correctly","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:12:06.5389125+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.2861709+07:00","closed_at":"2026-01-24T22:39:15.2861709+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-c0j","depends_on_id":"trollLLM-rb0","type":"blocks","created_at":"2026-01-24T22:12:06.5404803+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-c0j","depends_on_id":"trollLLM-0hk","type":"blocks","created_at":"2026-01-24T22:12:06.5425382+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-cf1","title":"Create Payment History page - Table with Pagination","description":"File: frontend/src/app/(dashboard)/payments/page.tsx\n\nCreate payment table:\n- Columns: Order Code, Credits, Amount (VND), Status, Created, Completed\n- Status badges with colors (green=success, yellow=pending, red=failed)\n- Order code truncated with full value on hover\n- Dates formatted DD/MM/YYYY HH:mm\n\nPagination:\n- Show current page, total pages\n- Previous/Next buttons\n- Page size: 20 items\n\nStates:\n- Loading skeleton\n- Empty state with message\n- Error state\n\nAcceptance Criteria:\n- Table displays data correctly\n- Pagination navigation works\n- Loading/empty/error states work\n- Mobile: horizontal scroll for table","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:12:38.7257898+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.5513614+07:00","closed_at":"2026-01-24T22:39:15.5513614+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-cf1","depends_on_id":"trollLLM-1ca","type":"blocks","created_at":"2026-01-24T22:12:38.7278521+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-cys","title":"Epic: Backend Error Logging (Node.js/Express)","description":"Implement error logging middleware for Node.js/Express backend to capture all 4xx/5xx errors and persist to MongoDB.\n\n**Goal**: Enable developers to debug and trace backend errors easily.\n\n**Scope**:\n- ErrorLog Mongoose model with TTL index (30 days)\n- Express middleware to intercept error responses\n- Async logging (non-blocking)\n- Sensitive data sanitization\n\n**Acceptance Criteria**:\n- All 4xx/5xx responses are logged to error_logs collection\n- No sensitive data (passwords, tokens) in logs\n- Logging doesn't impact response time\n- TTL auto-deletes logs after 30 days\n\n**Reference**: .sisyphus/plans/error-logging-mongodb.md","status":"closed","priority":1,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:18.879512+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:17:19.0040747+07:00","closed_at":"2026-01-23T00:17:19.0040747+07:00","close_reason":"Backend Error Logging complete: ErrorLog model, middleware, integration all done. Build passes."}
{"id":"trollLLM-dh2","title":"Epic: Backend API - Payment Stats \u0026 History","description":"Phase 1: Xây dựng backend API endpoints cho payment statistics và paginated history. Bao gồm repository methods, service layer, và REST endpoints.","status":"closed","priority":1,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:11:43.4598557+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:14.9970592+07:00","closed_at":"2026-01-24T22:39:14.9970592+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented"}
{"id":"trollLLM-dqk","title":"Verify TTL Index and Data Retention","description":"Verify MongoDB TTL index is working correctly.\n\n**Acceptance Criteria**:\n- TTL index exists on createdAt field\n- Index is set to expire after 2592000 seconds (30 days)\n- Manual verification that documents will be auto-deleted\n\n**Test Steps**:\n1. Connect to MongoDB\n2. Run: db.error_logs.getIndexes()\n3. Verify TTL index configuration\n4. (Optional) Create test document with old createdAt and verify deletion","status":"closed","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:43.7775451+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:48:01.0047836+07:00","closed_at":"2026-01-23T00:48:01.0047836+07:00","close_reason":"TTL index verified: createdAt_1 with expireAfterSeconds=2592000 (30 days). Compound indexes also present: source_1_createdAt_-1, path_1_createdAt_-1","dependencies":[{"issue_id":"trollLLM-dqk","depends_on_id":"trollLLM-ekb","type":"blocks","created_at":"2026-01-22T23:36:43.7791053+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-dqk","depends_on_id":"trollLLM-14s","type":"blocks","created_at":"2026-01-22T23:36:43.7812813+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-dqk","depends_on_id":"trollLLM-1jj","type":"blocks","created_at":"2026-01-23T00:06:01.3566551+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-ekb","title":"Test Backend Error Logging","description":"Verify backend error logging works correctly.\n\n**Acceptance Criteria**:\n- Trigger 400 error (e.g., invalid request body) and verify log in MongoDB\n- Trigger 401 error (invalid/missing auth) and verify log\n- Trigger 500 error (force server error) and verify log with stack trace\n- Verify sensitive data is sanitized (no passwords, tokens in logs)\n- Verify async logging doesn't block response time\n\n**Test Steps**:\n1. Start backend server\n2. Make requests that trigger various errors\n3. Query MongoDB: db.error_logs.find({source: 'backend'})\n4. Verify all fields are populated correctly\n5. Check no sensitive data in requestBody/requestHeaders","status":"closed","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:11.8525074+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:47:56.8232772+07:00","closed_at":"2026-01-23T00:47:56.8232772+07:00","close_reason":"Verified: Backend logs 401 (Invalid credentials), 400 (Validation failed), 404 (Not found) to error_logs collection. Password sanitized as [REDACTED].","dependencies":[{"issue_id":"trollLLM-ekb","depends_on_id":"trollLLM-ltc","type":"blocks","created_at":"2026-01-22T23:36:11.8545817+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-ekb","depends_on_id":"trollLLM-jcm","type":"blocks","created_at":"2026-01-22T23:36:11.8571659+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-ekb","depends_on_id":"trollLLM-1jj","type":"blocks","created_at":"2026-01-23T00:05:49.7008488+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-f67","title":"Fix Bug: Update lastUsedAt in main.go OpenHands handlers [CRITICAL]","status":"tombstone","priority":0,"issue_type":"bug","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:48:07.2997034+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T04:48:39.45055+07:00","deleted_at":"2026-01-23T04:48:39.45055+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"trollLLM-frq","title":"Create ErrorLog Mongoose Model","description":"Create error-log.model.ts with IErrorLog interface and Mongoose schema.\n\n**File**: backend/src/models/error-log.model.ts\n\n**Acceptance Criteria**:\n- Schema includes all fields: source, method, path, endpoint, userId, userKeyId, clientIp, userAgent, statusCode, errorType, errorMessage, errorDetails, requestHeaders, requestBody, responseBody, latencyMs, stackTrace, createdAt\n- TTL index set to 30 days (expires: 2592000)\n- Compound indexes for common queries (source+createdAt, path+createdAt)\n- Export IErrorLog interface and ErrorLog model\n\n**Technical Notes**:\n- Use mongoose.Schema.Types.Mixed for flexible fields (errorDetails, requestBody, etc.)\n- Collection name: 'error_logs'","acceptance_criteria":"- [ ] Schema includes all 16 fields from design doc\\n- [ ] TTL index configured: { createdAt: 1 }, { expireAfterSeconds: 2592000 }\\n- [ ] Compound indexes: { source: 1, createdAt: -1 }, { path: 1, createdAt: -1 }\\n- [ ] IErrorLog TypeScript interface exported\\n- [ ] ErrorLog Mongoose model exported\\n- [ ] Collection name is 'error_logs'\\n- [ ] npm run build passes","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:37.5794434+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:16:26.8491678+07:00","closed_at":"2026-01-23T00:16:26.8491678+07:00","close_reason":"Created ErrorLog Mongoose model with IErrorLog interface, 16 fields, TTL index (30 days), compound indexes. Exported from models/index.ts. Build passes.","dependencies":[{"issue_id":"trollLLM-frq","depends_on_id":"trollLLM-cys","type":"blocks","created_at":"2026-01-22T23:34:37.5809918+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-gwa","title":"Setup database schema for users","description":"Create User model with email, password hash, timestamps","status":"tombstone","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-21T03:41:13.033652+07:00","created_by":"hjsad1994","updated_at":"2026-01-21T03:46:53.058109+07:00","deleted_at":"2026-01-21T03:46:53.058109+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"trollLLM-jcm","title":"Export ErrorLog Model from models/index.ts","description":"Add ErrorLog model export to models barrel file.\n\n**File**: backend/src/models/index.ts\n\n**Acceptance Criteria**:\n- Add export * from './error-log.model.js'\n- Model is accessible via import from models/index\n\n**Technical Notes**:\n- Simple one-line addition to existing exports","status":"closed","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:04.5973334+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:16:40.0499755+07:00","closed_at":"2026-01-23T00:16:40.0499755+07:00","close_reason":"Already exported from models/index.ts as part of trollLLM-frq implementation","dependencies":[{"issue_id":"trollLLM-jcm","depends_on_id":"trollLLM-frq","type":"blocks","created_at":"2026-01-22T23:35:04.5988935+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-ltc","title":"Register Error Logger Middleware in Express App","description":"Register errorLoggerMiddleware in Express application.\n\n**File**: backend/src/index.ts\n\n**Acceptance Criteria**:\n- Import errorLoggerMiddleware from middleware\n- Register AFTER express.json() but BEFORE all routes\n- Middleware is applied globally to all routes\n\n**Technical Notes**:\n- Order matters: app.use(express.json()) then app.use(errorLoggerMiddleware)\n- Must be before route definitions to capture all errors","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:55.7250554+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:17:00.78757+07:00","closed_at":"2026-01-23T00:17:00.78757+07:00","close_reason":"Middleware already integrated in index.ts - imported and registered after express.json() before routes","dependencies":[{"issue_id":"trollLLM-ltc","depends_on_id":"trollLLM-o39","type":"blocks","created_at":"2026-01-22T23:34:55.7265935+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-mke","title":"Add payment history translations (EN/VI)","description":"File: frontend/src/components/LanguageProvider.tsx\n\nAdd translation keys for both EN and VI:\n\npayments: {\n  title, subtitle,\n  stats: { totalCredits, totalVND, successOrders, pendingOrders },\n  filters: { status, all, success, pending, failed, from, to, clear },\n  table: { orderCode, credits, amount, status, createdAt, completedAt },\n  empty: { title, description },\n  pagination: { prev, next, page, of }\n}\n\nsidebar: { payments }\n\nAcceptance Criteria:\n- All text on payment page uses translations\n- Language switcher works on payment page\n- No hardcoded strings remain","status":"closed","priority":2,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:12:48.9028187+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.678368+07:00","closed_at":"2026-01-24T22:39:15.678368+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-mke","depends_on_id":"trollLLM-njb","type":"blocks","created_at":"2026-01-24T22:12:48.9054241+07:00","created_by":"hjsad1994"},{"issue_id":"trollLLM-mke","depends_on_id":"trollLLM-9ez","type":"blocks","created_at":"2026-01-24T22:12:48.908094+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-n81","title":"Integrate SpendChecker in main.go","description":"After ConfigureOpenHands() success block (~line 4126): parse env vars (OPENHANDS_SPEND_THRESHOLD, intervals), call StartSpendChecker(). Add GET /openhands/spend-stats endpoint.","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:24:00.6027339+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T04:59:16.7370099+07:00","closed_at":"2026-01-23T04:59:16.7370099+07:00","close_reason":"Closed","dependencies":[{"issue_id":"trollLLM-n81","depends_on_id":"trollLLM-vyb","type":"blocks","created_at":"2026-01-23T04:24:00.6049049+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-njb","title":"Epic: i18n Translations","description":"Phase 3: Thêm translations cho Payment History page (EN/VI).","status":"closed","priority":2,"issue_type":"epic","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:11:45.6675971+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.1204161+07:00","closed_at":"2026-01-24T22:39:15.1204161+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented"}
{"id":"trollLLM-o39","title":"Create Error Logger Middleware","description":"Create Express middleware to intercept and log 4xx/5xx errors to MongoDB.\n\n**File**: backend/src/middleware/error-logger.middleware.ts\n\n**Acceptance Criteria**:\n- Intercepts res.json() to capture error responses\n- Only logs statusCode \u003e= 400\n- Logs asynchronously (setImmediate) to not block response\n- Sanitizes sensitive data (passwords, tokens, apiKey, secret)\n- Captures safe headers only (content-type, accept, origin, referer, x-request-id)\n- Classifies error types based on status code\n- Captures stack trace for 5xx errors\n\n**Technical Notes**:\n- Override res.json.bind(res) pattern\n- Use setImmediate for async logging\n- sanitizeBody() function for request body\n- getSafeHeaders() for header filtering\n- classifyError() for error type mapping","acceptance_criteria":"- [ ] Middleware function exported as errorLoggerMiddleware\\n- [ ] Intercepts res.json() using .bind(res) pattern\\n- [ ] Only logs when statusCode \u003e= 400\\n- [ ] Uses setImmediate() for async, non-blocking logging\\n- [ ] sanitizeBody() removes: password, token, apiKey, secret, authorization\\n- [ ] getSafeHeaders() only captures: content-type, accept, origin, referer, x-request-id\\n- [ ] classifyError() maps status codes to error types\\n- [ ] Captures Error.stack for 5xx errors\\n- [ ] source field set to 'backend'\\n- [ ] npm run build passes","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:34:47.1349271+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:16:41.3950425+07:00","closed_at":"2026-01-23T00:16:41.3950425+07:00","close_reason":"Created error-logger.middleware.ts with sanitization, safe headers, error classification, async logging. Integrated in index.ts. Build passes.","dependencies":[{"issue_id":"trollLLM-o39","depends_on_id":"trollLLM-frq","type":"blocks","created_at":"2026-01-22T23:34:47.1365359+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-q25","title":"Fix Bug: Update lastUsedAt in main.go OpenHands handlers [CRITICAL]","description":"## Problem\nTwo locations in goproxy/main.go update OpenHands key stats but do NOT update lastUsedAt:\n- Line ~1569 (OpenAI format handler)  \n- Line ~1994 (Anthropic format handler)\n\n## Files to Modify\n- goproxy/main.go\n\n## Changes (BOTH locations)\nAdd $set for lastUsedAt in UpdateByID call.\n\n## Verification\ngrep -A5 'OpenHandsKeysCollection().UpdateByID' goproxy/main.go | grep lastUsedAt\nShould show 2 matches.\n\n## Acceptance Criteria\n- Both handlers update lastUsedAt\n- Verification grep shows 2 matches\n- No regression in existing functionality","status":"tombstone","priority":0,"issue_type":"bug","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:48:39.6782363+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T04:49:21.6989914+07:00","deleted_at":"2026-01-23T04:49:21.6989914+07:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"trollLLM-rb0","title":"Add getUserPaymentStats() to payment repository","description":"File: backend/src/repositories/payment.repository.ts\n\nAdd MongoDB aggregation method to calculate user payment statistics:\n- totalCredits: Sum of credits from successful payments\n- totalVND: Sum of VND amount from successful payments  \n- successCount: Count of successful payments\n- pendingCount: Count of pending payments\n- failedCount: Count of failed/expired payments\n- totalOrders: Total payment count\n\nAcceptance Criteria:\n- Method returns correct stats for given userId\n- Returns zeros for users with no payments\n- Aggregation is efficient (single query)","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:11:55.8150923+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.1748566+07:00","closed_at":"2026-01-24T22:39:15.1748566+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-rb0","depends_on_id":"trollLLM-dh2","type":"blocks","created_at":"2026-01-24T22:11:55.8181964+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-vyb","title":"Write SpendChecker unit tests","description":"Create spend_checker_test.go with table-driven tests: TestSpendThresholdLogic, TestKeyActiveDetection, TestShouldCheckKeyIntervals, TestSpendHistoryEntry, TestMaskAPIKey, TestDefaultConstants","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-23T04:23:53.2470305+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T04:58:00.9333393+07:00","closed_at":"2026-01-23T04:58:00.9333393+07:00","close_reason":"Closed","dependencies":[{"issue_id":"trollLLM-vyb","depends_on_id":"trollLLM-26l","type":"blocks","created_at":"2026-01-23T04:23:53.2490847+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-wja","title":"Update main.go - Rate Limit \u0026 Payment Errors (~10 locations)","description":"Replace http.Error with errorlog.HTTPError for rate limit and payment error paths.\\n\\n**File**: goproxy/main.go\\n\\n**Scope**: Lines ~466, 629, 652, 657 and related locations\\n\\n**PARALLELIZATION NOTE**: This task can run IN PARALLEL with trollLLM-5td, trollLLM-846, trollLLM-bb1 since they modify different error paths.\\n\\n**Search Patterns**:\\n- http.StatusTooManyRequests (429)\\n- http.StatusPaymentRequired (402)\\n- http.StatusForbidden (403)\\n- \"Insufficient credits\"\\n- \"Rate limit exceeded\"\\n\\n**Technical Notes**:\\n- Include user context for billing/rate limit analysis\\n- Important for understanding usage patterns\\n- Pattern: errorlog.HTTPError(w, r, body, statusCode)\\n- Approximately 10 locations","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:36:00.9313886+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:30:16.2281151+07:00","closed_at":"2026-01-23T00:30:16.2281151+07:00","close_reason":"Updated rate limit and payment errors (insufficient credits, credits expired, migration required) with errorlog.JSONErrorWithUser calls","dependencies":[{"issue_id":"trollLLM-wja","depends_on_id":"trollLLM-5cd","type":"blocks","created_at":"2026-01-22T23:36:00.9329292+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-x9b","title":"Create errorlog Package Core (errorlog.go)","description":"Create the core errorlog package with ErrorLog struct and LogError function.\n\n**File**: goproxy/internal/errorlog/errorlog.go\n\n**Acceptance Criteria**:\n- ErrorLog struct with all fields matching backend schema\n- getCollection() with lazy initialization and index creation\n- ClassifyError() function for status code to error type mapping\n- GetClientIP() to extract client IP (X-Forwarded-For, X-Real-IP, RemoteAddr)\n- GetSafeHeaders() to filter sensitive headers\n- MaskAPIKey() to mask API keys for logging\n- LogError() that logs asynchronously via goroutine\n- LogErrorSimple() helper for basic logging\n\n**Technical Notes**:\n- Use go.mongodb.org/mongo-driver for MongoDB operations\n- Index creation is idempotent (runs on first getCollection call)\n- TTL index: 2592000 seconds (30 days)\n- Always log asynchronously with go func()","acceptance_criteria":"- [ ] ErrorLog struct with all 16 fields matching IErrorLog interface\\n- [ ] getCollection() with sync.Once for lazy init\\n- [ ] TTL index created: 2592000 seconds (30 days)\\n- [ ] Compound indexes: source+createdAt, path+createdAt\\n- [ ] ClassifyError(statusCode int) returns error type string\\n- [ ] GetClientIP(r *http.Request) extracts IP correctly\\n- [ ] GetSafeHeaders(r *http.Request) filters sensitive headers\\n- [ ] MaskAPIKey(key string) returns sk-troll***xyz format\\n- [ ] LogError() runs in goroutine (async)\\n- [ ] LogErrorSimple() helper for basic cases\\n- [ ] source field set to 'goproxy'\\n- [ ] go build passes","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-22T23:35:15.8097967+07:00","created_by":"hjsad1994","updated_at":"2026-01-23T00:29:57.29817+07:00","closed_at":"2026-01-23T00:29:57.29817+07:00","close_reason":"Created errorlog.go with ErrorLog struct, getCollection() with lazy init and indexes, ClassifyError, GetClientIP, GetSafeHeaders, MaskAPIKey, LogError (async), LogErrorSimple. Build passes.","dependencies":[{"issue_id":"trollLLM-x9b","depends_on_id":"trollLLM-33e","type":"blocks","created_at":"2026-01-22T23:35:15.8113312+07:00","created_by":"hjsad1994"}]}
{"id":"trollLLM-z89","title":"Create Payment History page - Filters","description":"File: frontend/src/app/(dashboard)/payments/page.tsx\n\nCreate filters section:\n- Status dropdown: All, Success, Pending, Failed\n- Date range: From date input, To date input\n- Clear filters button\n\nFilter state management:\n- useState for each filter\n- Filters trigger API reload\n- URL params sync (optional)\n\nAcceptance Criteria:\n- Filters work individually and combined\n- Clear resets all filters\n- UI shows current filter state\n- Date inputs use proper format","status":"closed","priority":1,"issue_type":"task","owner":"trantai306@gmail.com","created_at":"2026-01-24T22:12:34.4054262+07:00","created_by":"hjsad1994","updated_at":"2026-01-24T22:39:15.4941964+07:00","closed_at":"2026-01-24T22:39:15.4941964+07:00","close_reason":"Parent epic trollLLM-94p completed - Payment History feature fully implemented","dependencies":[{"issue_id":"trollLLM-z89","depends_on_id":"trollLLM-1ca","type":"blocks","created_at":"2026-01-24T22:12:34.4080028+07:00","created_by":"hjsad1994"}]}
